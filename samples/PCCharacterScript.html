<!DOCTYPE html>
<html>
<head>
<title>  </title>
<link rel="icon" type="image/png" href="../images/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>
<body>

<ul class="topnav">
	<li><a href="../games/PlasticCatastrophe.html#Block1">Close</a></li>
</ul>

    <pre class="CodeLightBox">
//sets the selected character based on character's ID value;
public void SetChar(int CharID){

    System.DateTime epochStart = new System.DateTime(1970, 1, 1, 0, 0, 0, System.DateTimeKind.Utc);

    if (CurrentChar.Name != "")
    {
        CurrentChar.LastUsed = (int)(System.DateTime.UtcNow - epochStart).TotalSeconds;
        SaveSystem.SaveAnimalData(CurrentChar);
    }

    CurrentChar = GameManager.Instance.CharList[CharID];

    //looks for a save for the animal, if not found, creates a new, default one.
    if (SaveSystem.LoadAnimalData(CurrentChar) == null)
    {
        Debug.Log("&lt;color=green&gt;Creating new save for character ID: " + CurrentChar.ID + " Name: " + CurrentChar.Name + "&lt;/color&gt;");
        CurrentChar.NextLevelReq = CurrentChar.BaseLevelReq;
        SaveSystem.SaveAnimalData(CurrentChar);
    }else
    {
        //loads save data
        AnimalSaveData data = SaveSystem.LoadAnimalData(CurrentChar);

        //sets loaded values
        SetPerk(data.Perk, false);
        CurrentChar.Name = data.Name;
        CurrentChar.Level = data.Level;
        CurrentChar.Exp = data.Exp;
        CurrentChar.NextLevelReq = data.NextLevelReq;
        CurrentChar.Energy = data.Energy;
        CurrentChar.LastUsed = data.TimeStamp;

        for (int i = 0; i &lt; data.PerksUnlocked.Length; i++)
        {
            CurrentChar.PerkList[i].Unlocked = data.PerksUnlocked[i];
        }

        if (CurrentChar.CurrentPerk != null && CurrentChar.CurrentPerk.modifier == PerkModifiers.EnergyModifier)
        {
            maxHealth = Mathf.CeilToInt((100 + (CurrentChar.Level * 5)) * CurrentChar.CurrentPerk.value);
        }
        else
        {
            maxHealth = 100 + (CurrentChar.Level * 5);
        }

        //adds more energy that recharged over time
        if (data.TimeStamp != 0)
        {
            Debug.Log(((((float)(System.DateTime.UtcNow - epochStart).TotalSeconds - data.TimeStamp) / 60) / 60) * 8);
            if (CurrentChar.CurrentPerk != null && CurrentChar.CurrentPerk.modifier == PerkModifiers.EnergyRecoveryModifier)
            {
                CurrentChar.Energy += (((((float)(System.DateTime.UtcNow - epochStart).TotalSeconds - data.TimeStamp) / 60) / 60) * 8) * CurrentChar.CurrentPerk.value;
            }
            else
            {
                CurrentChar.Energy += ((((float)(System.DateTime.UtcNow - epochStart).TotalSeconds - data.TimeStamp) / 60) /60) * 8;
            }

            if (CurrentChar.Energy &gt; maxHealth)
            {
                CurrentChar.Energy = maxHealth;
            }
        }
        UpdateMaxhealth();
        Updatehealth();
        currentXP = CurrentChar.Exp;
    }
    xp.SetMaxXP(CurrentChar.NextLevelReq);
    xp.SetXP(CurrentChar.Exp);
    Portrait.sprite = CurrentChar.Portrait;
    SpawnCharacter();
}

//Spawns character and removes the previous one.
void SpawnCharacter(bool ClearPrevious = true)
{
    if (ClearPrevious)
    {
        foreach (Transform child in CharContainer.transform)
        {
            Destroy(child.gameObject);
        }
    }

    Instantiate(CurrentChar.Prefab, CharContainer.transform);
}
                    
    </pre>

</body>
</html>
